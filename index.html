<!doctype html>
<html>
    <head>
        <title>Lead Manager</title>
    </head>
    <body onload="showNotificationBtn()">
        <h1>Lead Manager</h1>
        <button onclick="activateNotifications()" style="display: none;" id="activateNotificationsBtn">Activate notifications</button>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            var socket = io();
            socket.on('lead notification', function(data){
                var leadData = JSON.parse(data);
                var title = leadData.gotLocation ? "New lead in territory" : "New lead in unknown territory";
                var leadBody =  'Market: ' + leadData.Market + '\n\
                            ' + (leadData.gotLead ? 'Name: ' + leadData.Name + '\n\
                            Company: ' + leadData.Company + '\n\
                            Email: ' + leadData.Email + '\n\
                            Phone: ' (leadData.PhoneIsCell ? 'Cell-' : '') + leadData.PhoneValid + '-' + leadData.Phone : '');
                doNotification(title, leadBody);
            });
            function doNotification(title, leadBody) {
				if (!("Notification" in window)) {
					alert("This browser does not support desktop notification");
				} else if (Notification.permission === "granted") {
					var leadNotification = new Notification(title, {
						body: leadBody
					});
				} else if (Notification.permission !== 'denied') {
					alert("Notifications not activated!");
				};
            };
            function activateNotifications() {
				if (!("Notification" in window)) {
					alert("This browser does not support desktop notification");
				} else if (Notification.permission === "granted") {
					alert("Notifications already activated!");
				} else if (Notification.permission !== 'denied') {
					Notification.requestPermission(function (permission) {
						if (permission === "granted") {
							document.getElementById("activateNotificationsBtn").setAttribute("style", "display: none;");
							alert("Notifications activated!");
						};
					});
				};
			};
			function showNotificationBtn() {
				if ("Notification" in window && Notification.permission!== 'denied' && Notification.permission !== 'granted') {
					document.getElementById("activateNotificationsBtn").setAttribute("style", "");
				};
			};
        </script>
    </body>
</html>
